<?php 

    include '../config/inc/config.dashboard.php';
    $loc = 'dashboard';

    //initialize permission
    $iniPermArray = ['live_update'];
    if (!checkPermission($iniPermArray) === true)
    {

        include '../config/gui/msg/access_denied.html';
        die();
    }
?>
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet"
          href="../css/bootstrap.min.css">
    <link rel="stylesheet" href="../css/general.css">
    <link rel="shortcut icon"
          href="../assets/icos/general/Hms.png"
          type="image/x-icon">
    <title>SMHOS || Dashboard</title>
</head>

<body class="container-fluid p-0 bg-cprimary">
    
    <div class="row h-100 no-gutters">

        <!--Navigation-->
        <section class="col-sm-2 h-100 o-hide">
            <header class="h_main d-flex flex-wrap align-content-center justify-content-center">
                <strong class="cname"><?php echo $company_setup['c_name']; ?></strong>
            </header>

            <article class="a_main pt-1">
                <ul class="nav h-90 nav-pills nav-justified flex-column">

                    <!--Dashboard-->
                    <button onclick="location.href='<?php if ($loc !== 'dashboard') {echo '../dashboard/';}   ?>'" class="btn <?php if ($loc === 'dashboard') {echo 'btn-nav-active';} else {echo 'btn-nav';}   ?> text-left rounded-0 d-flex flex-wrap align-content-center justify-content-between">
                        <span class="w-20"><div class="ico-sm"><img src="../assets/icos/general/dashboard.png" alt="" class="img-fluid"></div></span>
                        <span class="w-80">Dashboard</span>
                    </button>

                    <?php if (isset($_SESSION['tax']) && $_SESSION['tax'] === true || isset($_SESSION['payment_method']) && $_SESSION['payment_method'] === true || isset($_SESSION['backup']) && $_SESSION['backup'] === true || isset($_SESSION['others']) && $_SESSION['others'] === true ): ?>
                        <!--Company Setup-->
                        <button onclick="location.href='<?php if ($loc !== 'company_setup') {echo '../company-setup/';}   ?>'" class="btn <?php if ($loc === 'company_setup') {echo 'btn-nav-active';} else {echo 'btn-nav';}   ?> text-left rounded-0 d-flex flex-wrap align-content-center justify-content-between">
                            <span class="w-20"><div class="ico-sm"><img src="../assets/icos/general/company_setup.png" alt="" class="img-fluid"></div></span>
                            <span class="w-80">Company Setup</span>
                        </button>
                    <?php endif; ?>



                    <!--Facility Management-->
                    <button onclick="location.href='<?php if ($loc !== 'facility_management') {echo '../facility-management/';}   ?>'" class="btn <?php if ($loc === 'facility_management') {echo 'btn-nav-active';} else {echo 'btn-nav';}   ?> text-left rounded-0 d-flex flex-wrap align-content-center justify-content-between">
                        <span class="w-20"><div class="ico-sm"><img src="../assets/icos/general/facility_management.png" alt="" class="img-fluid"></div></span>
                        <span class="w-80">Facility Management</span>
                    </button>

                    <!--User Management-->
                    <button onclick="location.href='../user-mgmt/'" class="btn btn-nav text-left rounded-0 d-flex flex-wrap align-content-center justify-content-between">
                        <span class="w-20"><div class="ico-sm"><img src="../assets/icos/general/user_management.png" alt="" class="img-fluid"></div></span>
                        <span class="w-80">User Management</span>
                    </button>

                    <!--Reports-->
                    <button onclick="location.href='../reports/'" class="btn btn-nav text-left rounded-0 d-flex flex-wrap align-content-center justify-content-between">
                        <span class="w-20"><div class="ico-sm"><img src="../assets/icos/general/reports.png" alt="" class="img-fluid"></div></span>
                        <span class="w-80">Reports</span>
                    </button>

                </ul>

                <div class="w-100 h-10">
                    <button onclick="loction.href='www.facebook.com'" class="btn btn-csecondary rounded-0 h-100 w-100">Powered By Rootech.inc</button>
                </div>
            </article>
        </section>

        <!--Work Space-->
        <section class="col-sm-10 h-100 bg-cmain o-hide">
            <!--work space header-->
            <header class="bg-clight">
                <div class="w-25 ml-auto h-100 d-flex flex-wrap justify-content-end pr-2 align-content-center">
                    <!--Username-->
                    <div style="height: 30px;" class="d-flex flex-wrap align-content-center">
                        <span class="mr-1 ml-1"><?php echo $user_details['first_name'] . ' ' . $user_details['last_name'] ?></span>
                    </div>
                    <!--Logout-->
                    <div onclick="location.href='../config/inc/logout.php'" data-toggle="tooltip" title="logout" class="ico-nm pointer bg-success rounded-circle ml-1 border border-success">
                        <img src="../assets/icos/general/logout.png" alt="" class="img-fluid">
                    </div>
                </div>
            </header>

            <!--WorkSpace-->
            <article>

                <div class="container p-0 w-90 h-100 o-hide">
                    <!--Head-->
                    <div class="head p-3 d-flex flex-wrap align-content-center">
                        <span>Overview</span>
                    </div>

                    <!--Middle-->
                    <div class="middle container w-100 p-0">
                        <div class="row o-hide no-gutters w-100 h-100">

                            <!--Card 1-->
                            <div class="col-sm-4 p-3">
                                <div class="rcard w-100 p-3 h-100 d-flex flex-wrap align-content-between">

                                    <div class="w-100 h-100">
                                        <div class="w-100 clearfix h-40">
                                            <span class="rcard-title float-left">Total Booking</span>
                                             
                                        </div>
    
                                        <div class="w-100 h-60 rcard_details clearfix">
                                            <!--Count-->
                                            <div class="w-50 h-100 float-left">

                                                <div class="w-100 h-100 d-flex flex-wrap align-content-end">
                                                    <?php if ($shift === true):?>
                                                        <p class="p-0 text-dark bold m-0"><?php echo $total_booking; ?></p>
                                                    <?php endif; ?>

                                                    <?php if ($shift === false):?>
                                                        <p class="p-0 text-muted font-italic text_sm m-0">start shift</p>
                                                    <?php endif; ?>
                                                </div>
                                            </div>

                                            <!--graph-->
                                            <div class="w-50 h-100 float-right d-flex flex-wrap align-content-end justify-content-end">
                                                <?php if ($shift === true):?>
                                                    <span class="text-success t-nm">&uArr; good</span>
                                                <?php endif; ?>
                                            </div>

                                        </div>
                                    </div>

                                </div>
                            </div>

                            <!--Card 2-->
                            <div class="col-sm-4 p-3">
                                <div class="rcard w-100 p-3 h-100 d-flex flex-wrap align-content-between">

                                    <div class="w-100 h-100">
                                        <div class="w-100 clearfix h-40">
                                            <span class="rcard-title float-left">Total Checkin</span>
                                             
                                        </div>
    
                                        <div class="w-100 h-60 rcard_details clearfix">
                                            <!--Count-->
                                            <div class="w-50 h-100 float-left">

                                                <div class="w-100 h-100 d-flex flex-wrap align-content-end">
                                                    <?php if ($shift === true):?>
                                                        <p class="p-0 text-dark bold m-0"><?php echo $total_checkin; ?></p>
                                                    <?php endif; ?>
                                                    <?php if ($shift === false):?>
                                                        <p class="p-0 text-muted font-italic text_sm m-0">start shift</p>
                                                    <?php endif; ?>
                                                </div>
                                            </div>

                                            <!--graph-->
                                            <div class="w-50 h-100 float-right d-flex flex-wrap align-content-end justify-content-end">
                                                <?php if ($shift === true):?>
                                                    <span class="text-success t-nm">&uArr; good</span>
                                                <?php endif; ?>
                                            </div>

                                        </div>
                                    </div>

                                </div>
                            </div>

                            <!--Card 3-->
                            <div class="col-sm-4 p-3">
                                <div class="rcard w-100 p-3 h-100 d-flex flex-wrap align-content-between">

                                    <div class="w-100 h-100">
                                        <div class="w-100 clearfix h-40">
                                            <span class="rcard-title float-left">Shift Time</span>
                                             
                                        </div>
    
                                        <div class="w-100 h-60 rcard_details clearfix">
                                            <!--Count-->
                                            <div class="w-50 h-100 float-left">

                                                <div class="w-100 h-100 d-flex flex-wrap align-content-end">
                                                    <?php if ($shift === true):?>
                                                        <p class="p-0 text-dark bold m-0"><?php echo $shift_time; ?></p>
                                                    <?php endif; ?>
                                                    <?php if ($shift === false):?>
                                                    <p class="p-0 text-muted font-italic text_sm m-0">start shift</p>
                                                    <?php endif; ?>
                                                </div>
                                            </div>

                                            <!--graph-->
                                            <div class="w-50 h-100 float-right d-flex flex-wrap align-content-end justify-content-end">
                                                <?php if ($shift === true):?>
<!--                                                    <span class="text-danger t-nm">&dArr; poor</span>-->
                                                <?php endif; ?>
                                            </div>

                                        </div>
                                    </div>

                                </div>
                            </div>

                        </div>
                    </div>

                    <!--Bottom-->
                    <div class="bottom p-3">

                        <main class="w-100 card p-1 h-100">
                            <div class="w-100 d-flex flex-wrap text-center align-content-center justify-content-center h-100">
                                <?php if ($shift != true): ?>
                                    <!--START SHIFT-->
                                    <button onclick="popupwindow('shift.php','SHIFT', 300,300)" class="btn p-4 btn-info">
                                        Start Master Shift
                                    </button>
                                <?php endif; ?>

                                <?php if ($shift === true): ?>
                                    <h1 id="updatedValue" class="display-1">Loading...</h1>
                                    <script>

                                        setInterval(
                                            function updateLiveIncome() {
                                                if (window.XMLHttpRequest) {
                                                    xmlhttp = new XMLHttpRequest();
                                                }
                                                else {
                                                    xmlhttp = new ActiveXObject('Microsoft.XMLHTTP');
                                                }

                                                xmlhttp.onreadystatechange = function () {
                                                    if (xmlhttp.readyState == 4 && xmlhttp.status == 200) {
                                                        document.getElementById('updatedValue').innerHTML = xmlhttp.responseText;
                                                    }
                                                }

                                                xmlhttp.open('GET', '../config/proc/ajax.php?update', true);
                                                xmlhttp.send();
                                            }, 1000);

                                    </script>
                                <?php endif; ?>
                            </div>
                        </main>

                    </div>
                </div>

            </article>
        </section>

    </div>




    <!-- Optional JavaScript -->
    <!-- jQuery first, then Popper.js, then Bootstrap JS -->
    <script src="../js/jquery-3.2.1.slim.min.js"
            integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN"
            crossorigin="anonymous"></script>
    <script src="../js/popper.min.js"
            integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q"
            crossorigin="anonymous"></script>
    <script src="../js/bootstrap.min.js"
            integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl"
            crossorigin="anonymous"></script>

    <script>
        $(document).ready(function(){
        $('[data-toggle="tooltip"]').tooltip();
        });
    </script>

    <script>
        function popupwindow(url, title, w, h) {
            var left = (screen.width/2)-(w/2);
            var top = (screen.height/2)-(h/2);
            var reAssignWindow = open(url, title, 'toolbar=no, location=no, directories=no, status=no, menubar=no, scrollbars=no, resizable=no, copyhistory=no, width='+w+', height='+h+', top='+top+', left='+left);
            reAssignWindow.focus();

            setInterval(
                function updateLiveIncome() {
                    if (window.XMLHttpRequest) {
                        xmlhttp = new XMLHttpRequest();
                    }
                    else {
                        xmlhttp = new ActiveXObject('Microsoft.XMLHTTP');
                    }

                    xmlhttp.onreadystatechange = function () {
                        if (xmlhttp.readyState == 4 && xmlhttp.status == 200) {

                            const ajaxRes = xmlhttp.responseText;
                            console.log(ajaxRes);
                            if (ajaxRes === 'reload')
                            {
                                window.location.reload();
                            }
                        }
                    }

                    xmlhttp.open('GET', '../config/proc/ajax.php?check_sift_start', true);
                    xmlhttp.send();

                }, 1000);


        }
    </script>
</body>

</html>